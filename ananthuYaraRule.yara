rule ananthuYaraRule{

   meta:

      Description = "Simple YARA rule to detect shade malware"
      Author = "Ananthu.R.krishnan (MT20ACS493)"
      Date = "2021-08-25"
      hash1 = "bf32e333d663fe20ab1c77d2f3f3af946fb159c51b1cd3b4b2afd6fc3e1897bb"

   strings:

      $url1 = "http://www.usertrust.com1" fullword ascii
      $url2 = "http://ocsp.usertrust.com0" fullword ascii 
      $url3 = "1http://crl.usertrust.com/" 
      
      $str1 = "AEQATRXK" fullword ascii
      $str2 = "AEQATRXK0" fullword ascii
      $str3 = "The USERTRUST Network1!0" fullword ascii
      $str4 = "UTN-USERFirst-Object0"
 
      $process1 = "GetProcAddress" fullword ascii
      $process2 = "LoadLibraryW" fullword  ascii
      $process3 = "LoadLibraryA" fullword ascii
      $process4 = "RegOpenKeyExA" fullword ascii 
      $process5 = "RegQueryValueExW" fullword ascii
      $process6 = "GetForegroundWindow" fullword ascii
      $process7 = "GetAsyncKeyState" fullword ascii
      $process8 = "VirtualAlloc" fullword ascii
      $process9 = "VirtualProtect" fullword ascii
    
      $dll1 = "USER32.dll" nocase ascii wide fullword
      $dll2 = "GDI32.dll" nocase ascii wide fullword
      $dll3 = "ADVAPI32.dll" nocase ascii wide fullword
      $dll4 = "KERNEL32.dll" nocase ascii wide fullword
     
   condition:

      uint16(0) == 0x5a4d 
      and filesize < 2000KB
      and 2 of ($url*)
      and 3 of ($str*)
      and 6 of ($process*)  
      and 3 of ($dll*) 

}
